# 아폴로 서버 로드맵

이 로드맵은 **아폴로 버전 3.x** 사용을 위함입니다.

## 제품의 비전

아폴로 서버는 데이터 그래프를 구현하고 동작하기 위한 프레임워크입니다. 이것은 타입스크립트로 쓰여졌고, ES2018-서포팅 환경(Node.js, V8, 등) 에서 실행 할 수 있습니다. 그래서, Apollo GraphQL플랫폼과 매우 단단히 이어질 수 있습니다.
아폴로 서버는 매우 쉽게 사용할수 있고, 제품 팀들을 위해 문서화가 잘 되어 있습니다. 이것은 그래프를 설계하고 만들기 위해, 기본적인 세팅의 툴들을 제공합니다, 그리고 여러팀의 협업을 거치며 수백명의 엔지니어들이 하나의 그래프를 측정하며 공동 작업합니다.

## Apollo Server 3.x

아폴로 서버의 다음 버전은 생산 준비가 된 GraphQL 프레임워크의 기본 구현체입니다. 이것은 우리의 커뮤니티와 소비자들을 지원하기 위한 우리의 능력을 방해하는 기술 부채들을 제거 합니다.

### 목표

- Apollo Server는 잘 정의된 서비스의 범위 내에서 **product 팀들이 그래프를 구현하기 위해 돕는 패턴과 기능을** 제공합니다.
  - Apollo 연합의 spec, DataSources 그리고 프로젝트 권장 구조의 일부분을 사용하는 스키마 모듈을 위한 최고의 방법들이 포함되어 있습니다.
  - 필요로 할 때, federated architecture에 원할한 트랜잭션을 허용 합니다.
  - 데이터 fetching, batching, 그리고 데이터 캐싱을 촉진하기 위해 그래프의 `Entity`들을 이용하여 실행을 향상시킵니다.
  - 팀들에게 구조화된 데이터 그래프를 설계하는 것을 안내하는 재 설계된 문서들을 포함합니다.

    - 처음부터 제품 엔지니어들이 생산적일 수 있게 설계된 새로운 시작환경을 제공합니다.
    - architecture와 설계된 그래프를 위한 패턴을 설명합니다.
    - 모범 사례들을 사용한 제품에서 어떻게 그래프가 작동하는지 설명합니다.

  - 오직 모든 팀들을 위해 작동되는 Apollo Server package를 설치하기만 하면 됩니다.
    - 입문서와 수십개의 패키지들이 통합되어야 할 필요가 없는 "제공된 기능"이 완성되어 있습니다.
- Apollo Server는 최신 클라우드 인프라에 적합한 **내장된 HTTP layer, 기능이 풍부한 transport layer와 좋은 구조화** 가 되어 있습니다.
  - 다양한 Node.js HTTP framework를 통합하기 위해 오직 약간의 snippet 복붙만을 요구합니다.
  - consuming과 header setting, status codes, 그리고 실행동안의 쿠키를 위한 내장된 서포트를 포함합니다.
  - 전체 쿼리의 캐싱과 CDN늬 통합을 위한 Apollo cache 컨트롤을 지원합니다.
  - 효과적인 실행과 통합된 캐싱 계층을 통해 기업 크기의 트래픽을 지원합니다.
  - 프로덕션 팀들을 프로덕션 환경에서 **자신있는 실행과 그들의 graph를 모니터링하기 위한 tools 과 hooks**를 가지고 있습니다.
  - 그래프와 요청의 생애주기들은 훌륭히 문서화되어 있고 모니터링을 설정하는 팀들을 위한 디테일한 observability hooks를 포함하고 있습니다.
  - Apollo Server는 Apollo Graph Manager를 위한 내장 서비스를 포함하고 있습니다.
  - 새로운 요청 파이프 라인은 팀들에게 유효성 검사, 파싱 및 오류 처리를 포함하여 요청 수명주기를보다 효과적으로 제어 할 수 있게 합니다.

## How we get there

Apollo Server 3는 Apollo Server 2.x.을 유지하고 계속해서 지원해가면서, 재 작성되어 Apollo Server project에 자리잡을 것입니다. 기능완성이 되기 전에(WebSockets or subscriptions 은 지원하지 않습니다.) 가능한 빨리 새로운 구성의 핵심이 사용되기 위해 준비될 것이고, 우리는 pre-release 주기를 시작할 것이고, 새로운 패키지 적용을 시작하기 위해 커뮤니티를 장려할 것 입니다. **3.0 초기에는 많은 기능들이 정착 되지 않고 이전 버전에 정착 될 수 있습니다.**
이러한 목표를 달성하기 위한 일은 작업에 따라 그룹화 되어집니다.

- **향상된 패키징, 모든 크기의 그래프들을 올바르게 구현하기 위해 도울 패턴들**

  - 각각의 완성된의 부분을 정의하는 스키마 모듈을 위한 지원을 완료합니다 :
    - 로컬 스키마 모듈에서 federation directives를 사용하고, single entity fetch 메소드를 지원합니다. (`__resolveObject`와`__resolveReference`를 하나의`loadEntity` API로 병합)
    - 로컬 서비스들의 정적인 검증을 지원합니다. (이것은 하나로 뭉쳐진 서비스들로부터 비롯된 "모듈" 컨셉들과 federation으로부터의 "서비스" 컨셉을 통일합니다. )
    - 스키마를 구성하기 위해 `typeDefs` 와 `resolvers`를 사용하는 팀들을 위한 역호환성을 유지합니다.
  - 실행을 수정하는 것을 위한 스키마 명령어를 지원합니다 :
    -federated graphs와 비 federated graphs 두 가지 모두를 위한 `@cacheControl` 명령어를 지원합니다.
  - batching과 caching을 지원하기 위해 `DataSource` API를 완료합니다.
    - 요청동안 실행되는 캐싱과 배치된 작업들을 보여주기 위해 통합 추적을 포함합니다.
    - 위에서 언급된 새로운`loadEntity`API와 직접적으로 통합합니다.
  - 쉬운 사용을 위한 패키징을 단순화 : `@apollo/server` and `@apollo/graphql`.
    - 두 패키지들 (현재 [38 packages](https://github.com/apollographql/apollo-server/tree/fef7a13b81a46dd3a05cc65409ddba6688fc281d/packages)):
    - Node.js의 오래된 버전들을 위한 지원의 중단, 오직 Node.js v10과 그 이후 버전만을 지원
    - 접합된 구독 지원 제거와 업로드 기본 포함, 별도의 진입점과 같은 구독
  - 완전히 재작성된 문서 사이트 :
    - 제품 엔지니어가 첫날 생산성을 높일 수 있도록 재구성 된 시작 환경을 포함합니다.
    - Apollo Server의 아키텍쳐와 어떻게 이러한 컴포넌트들이 함께 작동하는지도 설명합니다.
    - `Entity` 및`DataSource`와 같은 핵심 기능을 사용하여 데이터 그래프를 작성하는 방법을 보여줍니다.
    - 제품 작동을 위한 향상된 가이드라인을 제공합니다.

- **새로운 transport 추상화 와 상응하는 HTTP 구현:**
  - 클라이언트에서 "chunked"한 결과를 리턴하기 위해 `AsyncIterator`를 사용할 수 있는 새로운 일반적인 generic transport interface. 서버는 수십개의 transports를 지원해야 합니다.
    - 아폴로 서버는 기본적으로 `http`통신으로 전달 하는데, `http.createServer`와 이에 상응하는`IncomingMessage` 및`ServerResponse` 인터페이스를 사용합니다.
      - 이것은 headers, status code 그리고 response streaming을 적절하게 지원해야 합니다
    - 문서는 일반적인 Node.js HTTP 프레임워크들 (Express, Koa, Hapi, etc.)이 통합되기 위한 예제들을 포함하고 있으며, 팀들은 그들이 존재하는 서버에 Apollo Server의 functionality을 복붙할수 있습니다.
    - - Node.js 프레임워크가 필요 없는 팀에는 기본 `ApoloServer` 설정이 제공될 것입니다.

* **실행 중 발생하는 상황을 관찰하고 더 잘 제어 할 수 있는 새로운 `RequestPipeline`**
  - transport의 요구로부터 GrahpQL의 요구들을 분리하는(고립시키는) 핵심 `GraphQLService` API
    이것은 잘 문서화되고 합리적인 요청 파이프 라인으로 구성되며 새로운 모듈 패턴을 활용하기 위해 향상된 실행과 결합됩니다.
    - 주요 그래프 이벤트를 listen 하기위한 Observability hooks
      - **Graph-level**: ready, shutdown, schema change, service list change, errors, etc.
      - **Transport-level**: start, complete, error
      - **Execution-level**: parse, validate, execute, error
    - 핵심 요청 파이프 라인내에서 사용자의 행동을 허용해주기 위한 Control hooks
      - **Graph-level**: build schema, update schema, shutdown, etc.
      - **Transport-level**: transform request, transform response
      - **Execution-level**: parse, validate, execute

## Future work

- **First-class는 `@defer`, 와 `@stream` subscriptions을 지원한다.**

  - Subscriptions - 위에서 묘사된 새로운 transport 인터페이스를 사용하여 웹소켓 transport를 구현합니다. - Apollo Graph Manager에서 보낸 데이터 추적에서 subscriptions을 지원합니다.
    \ - Query planner 를 지원합니다.
  - `@defer` 와 `@stream`
    - the HTTP transport에서 response streams 을 지원합니다.
    - 클라이언트들에게 보내기 위한 "chunked"한 responses를 허용하기 위해 실행을 확장합니다.
    - "chunk"한 응답들이 클라이언트들에게 보내질 수 있도록 실행을 확장합니다.
    - 추적 기록에 "chunk"한 실행의 추적을 지원 합니다.
    - "chunk" 한 응답들을 다루기 위한 아폴로 클라이언트의 지원을 추가합니다 \* Query Planner지원을 추가합니다.

- **향상된 생산 요구들을 위한 Global graph 명령어**
  - 이것은 팀들이 그들의 그래프를 안정적으로 확장 할 수 있게 도와주는 작은 Apollo-특정 명령어 세트 입니다.
    - `@auth` 지시어를 포함합니다.( 정의 되어야 합니다. )
    - 필드들이 "안정적인" 그래프의 부분이 아니라, 특정한 팀의 실험에 사용될수 있음을 나타내기 위한 `@experimental`를 포함합니다.
- CDN 통합과 함께 캐시 태그를 통한 전체 쿼리 캐시의 무효화
- 게이트웨이를 위한 캐싱 레이어의 "graph" 구축
  - 아폴로 클라이언트 혹은 graph level을 디자인한 다른 버전으로부터 `EntityCache`를 사용 할 것.
  - 서비스와 모듈 경계들을 거치는 "부분 쿼리 캐싱"을 위한 요구를 충족 할 것
  - Will fulfill the need for "partial query caching" across service and module boundaries.

## 기술 부채 상환

이 절은 아폴로 서버 3.0에 대해 수행되어야 할 작업을 이해하는 데 중요하지 않지만, 그것을 작동하기 위해 수행되는 작업의 더 많은 의미를 이해하는 데 도움이 됩니다.

- 기본 HTTP 전송을 선호하는 모든 `apollo-server-<integration>` 패키지들의 제거와 프로덕션-준비, 즉시 실행가능한 경험의 전송을 하기 위해 또 다른 일반적인 패턴을 위한 문서의 복-붙 요약
- 현재 수많은 저장소들과 패키지들 사이에 퍼진 추가적인 모듈과 함께 `@apollo/graphql`을 선호하는 `graphql-tools`의 제거
- 메인 요청 파이프라인의 모든 이점을 가지는 내장된 솔루션을 선호하는 `subscription-transport-ws`의 제거
- core team과 기여자들을 위한 개발 경험의 단순화(예 : 더 좋은 test suite, 더 쉬운 publishing, 더 쉬운 커뮤니티 기여)
- 수많은 API들과 패키지들의 통일 ( `apollo-server-errors`, `graphql-extensions`, `apollo-datasource`, `apollo-env`, 등.)
- 지원 범위로부터 수명을 다한 Node.js 버전(Node.js 6과 8)에 지원 중단
